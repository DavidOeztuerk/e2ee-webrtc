# Redis Configuration
# Generated by Ansible

# Network
bind {{ redis_bind | default('0.0.0.0') }}
port {{ redis_port | default(6379) }}
protected-mode yes

# Security
requirepass {{ redis_password }}

# Memory
maxmemory {{ redis_maxmemory | default('1gb') }}
maxmemory-policy {{ redis_maxmemory_policy | default('volatile-lru') }}

# Persistence
save 900 1
save 300 10
save 60 10000
appendonly {{ redis_appendonly | default('yes') }}
appendfsync {{ redis_appendfsync | default('everysec') }}

# Logging
loglevel {{ redis_loglevel | default('notice') }}
logfile /var/log/redis/redis-server.log

# Performance
tcp-backlog 511
tcp-keepalive 300
databases {{ redis_databases | default(16) }}

# Limits
maxclients {{ redis_maxclients | default(10000) }}

# Snapshotting
dir {{ redis_data_dir | default('/var/lib/redis') }}
dbfilename dump.rdb

# Security hardening
{% if redis_disable_dangerous_commands | default(true) %}
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG ""
rename-command SHUTDOWN REDIS_SHUTDOWN_{{ redis_password[:8] }}
{% endif %}

# Replication
{% if redis_replicaof is defined %}
replicaof {{ redis_replicaof.host }} {{ redis_replicaof.port }}
masterauth {{ redis_replicaof.password | default(redis_password) }}
{% endif %}

# Cluster (if enabled)
{% if redis_cluster_enabled | default(false) %}
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
{% endif %}
