# TURN Server Configuration
# Generated by Ansible

# Network settings
listening-port=3478
tls-listening-port=5349
listening-ip=0.0.0.0
relay-ip={{ public_ip | default(ansible_default_ipv4.address) }}
external-ip={{ public_ip | default(ansible_default_ipv4.address) }}

# Authentication
use-auth-secret
static-auth-secret={{ turn_secret }}
realm={{ turn_realm | default(domain_name) }}

# TLS (configure your certificates)
{% if turn_cert_path is defined %}
cert={{ turn_cert_path }}
pkey={{ turn_key_path }}
{% endif %}

# TURN relay ports
min-port={{ turn_min_port | default(49152) }}
max-port={{ turn_max_port | default(65535) }}

# Logging
log-file=/var/log/turnserver/turnserver.log
{% if log_level == 'debug' %}
verbose
{% endif %}

# Security
fingerprint
lt-cred-mech
no-multicast-peers
no-cli
no-tlsv1
no-tlsv1_1

# Performance
proc-quota={{ turn_proc_quota | default(100) }}
stale-nonce={{ turn_stale_nonce | default(600) }}
max-allocate-lifetime={{ turn_max_allocate_lifetime | default(3600) }}
channel-lifetime={{ turn_channel_lifetime | default(600) }}
permission-lifetime={{ turn_permission_lifetime | default(300) }}

# Limits
total-quota={{ turn_total_quota | default(1000) }}
bps-capacity={{ turn_bps_capacity | default(0) }}
user-quota={{ turn_user_quota | default(12) }}

# WebRTC optimizations
mobility
no-tcp-relay
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=192.168.0.0-192.168.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=127.0.0.0-127.255.255.255

# Additional security
{% for ip in turn_allowed_peer_ips | default([]) %}
allowed-peer-ip={{ ip }}
{% endfor %}
